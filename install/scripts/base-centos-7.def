BootStrap: docker
From: centos:centos7

%environment
HIPSYCL_BASE_CC=gcc
HIPSYCL_BASE_CXX=g++
. /opt/rh/devtoolset-7/enable
%setup
cp ./install-hipsycl.sh ${SINGULARITY_ROOTFS}/install-hipsycl.sh
cp ./install-cuda.sh ${SINGULARITY_ROOTFS}/install-cuda.sh
cp ./install-base-spack.sh ${SINGULARITY_ROOTFS}/install-base-spack.sh
cp ./spack-install-hipsycl-centos.sh ${SINGULARITY_ROOTFS}/spack-install-hipsycl.sh 
cp ./spack-install-llvm.sh ${SINGULARITY_ROOTFS}/spack-install-llvm.sh 
cp ./spack-install-boost.sh ${SINGULARITY_ROOTFS}/spack-install-boost.sh 
cp ./spack-install-rocm.sh ${SINGULARITY_ROOTFS}/spack-install-rocm.sh 
cp ./spack-syclcc.json ${SINGULARITY_ROOTFS}/syclcc.json

%post
yum update -y
yum install epel-release -y
yum install -y rpm-build sed unzip python34 python3 git parallel wget perl perl-Data-Dumper cmake3 curl patch 
yum install centos-release-scl -y
yum install devtoolset-7 -y
yum install lbzip2 -y
#We neeed proper cmake 
yum remove cmake
ln -s /usr/bin/cmake3 /usr/bin/cmake
bash /install-cuda.sh
#bash /install-base-spack.sh

